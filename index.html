<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON DODGE - ADVANCED ADMIN</title>
    <style>
        :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffd700; --space: #020205; --dark: #0a0a1a; }
        body { margin: 0; background: var(--space); font-family: 'Segoe UI', sans-serif; overflow: hidden; color: white; touch-action: none; }
        canvas { display: block; }
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: rgba(0,0,0,0.92); backdrop-filter: blur(10px); }
        .active { display: flex; }
        .box { background: var(--dark); padding: 25px; border-radius: 20px; border: 1px solid var(--neon); width: 340px; text-align: center; position: relative; }
        .btn { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
        .btn-cyan { background: var(--neon); color: #000; }
        .btn-pink { background: var(--pink); color: #fff; }
        .btn-grey { background: #333; color: #ccc; font-size: 10px; margin-top: 5px; }
        .btn-sml { padding: 5px 8px; font-size: 9px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; margin-right: 2px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; max-height: 180px; overflow-y: auto; padding: 10px; border: 1px solid #222; border-radius: 10px; background: #050510; }
        .item { background: #111; padding: 8px; border-radius: 8px; border: 2px solid transparent; cursor: pointer; font-size: 9px; }
        .item.active { border-color: var(--neon); background: rgba(0,242,255,0.1); }
        .pre { width: 18px; height: 18px; margin: 0 auto 5px; clip-path: polygon(50% 0, 0 100%, 100% 100%); }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #333; background: #000; color: #fff; font-size: 12px; box-sizing: border-box; }
        
        .admin-list { text-align: left; font-size: 11px; max-height: 200px; overflow-y: auto; background: #000; padding: 10px; border-radius: 10px; border: 1px solid #444; margin: 10px 0; }
        .user-row { border-bottom: 1px solid #333; padding: 10px 0; }
        .admin-controls { display: flex; gap: 5px; margin-top: 5px; }
        .admin-controls input { width: 60px; padding: 4px; margin: 0; }
        
        #hud { position: absolute; top: 20px; left: 20px; z-index: 50; font-weight: bold; font-size: 1.2rem; display: none; color: var(--neon); }
    </style>
</head>
<body>

<div id="hud">SKOR: <span id="skor-val">0</span></div>

<div id="scr-welcome" class="screen active">
    <h1 style="color:var(--neon); text-shadow: 0 0 20px var(--neon)">SPACE ANDIKA üöÄüåå</h1>
    <div class="box">
        <button class="btn btn-cyan" onclick="initAudio(); nav('scr-login')">LOGIN</button>
        <button class="btn btn-pink" onclick="initAudio(); nav('scr-register')">DAFTAR</button>
    </div>
</div>

<div id="scr-login" class="screen"><div class="box"><h2>MASUK</h2><input type="text" id="l-u" placeholder="User"><input type="password" id="l-p" placeholder="Pass"><button class="btn btn-cyan" onclick="doLogin()">LOGIN</button></div></div>
<div id="scr-register" class="screen"><div class="box"><h2>DAFTAR</h2><input type="text" id="r-u" placeholder="User"><input type="password" id="r-p" placeholder="Pass"><button class="btn btn-pink" onclick="doRegister()">BUAT AKUN</button></div></div>

<div id="scr-menu" class="screen">
    <div class="box" style="width: 360px;">
        <div id="admin-panel" style="display:none; margin-bottom:15px;">
            <p style="color:var(--gold); font-size: 11px; margin: 0; font-weight:bold">üõ°Ô∏è KONTROL DATABASE</p>
            <div class="admin-list" id="user-list"></div>
        </div>

        <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span id="u-n" style="color:var(--neon); font-weight:bold">-</span><span id="u-c" style="color:var(--gold); font-weight:bold">0 C</span></div>
        <div class="grid" id="skin-grid"></div>
        <button class="btn btn-pink" onclick="start()">MULAI GAME</button>
        <button class="btn btn-grey" onclick="doLogOut()">LOG OUT</button>
    </div>
</div>

<div id="scr-over" class="screen">
    <div class="box"><h2>GAME OVER</h2><p>Skor: <span id="final-skor">0</span></p><button class="btn btn-cyan" onclick="start()">ULANGI</button><button class="btn btn-grey" onclick="nav('scr-menu')">MENU</button></div>
</div>

<canvas id="game"></canvas>

<script>
const cvs = document.getElementById('game'), ctx = cvs.getContext('2d');
let user = null, db = JSON.parse(localStorage.getItem('nd_v9_db')) || {};

const SKINS = [
    {id:0, n:"Starter", c:"#00f2ff", cost:0, speed:0.12, firerate:300},
    {id:1, n:"Ruby", c:"#ff007f", cost:1000, speed:0.14, firerate:280},
    {id:4, n:"Volt", c:"#ffff00", cost:8000, speed:0.20, firerate:220},
    {id:11, n:"Void", c:"#8e44ad", cost:25000, speed:0.26, firerate:160, border:"#fff"},
    {id:12, n:"TITAN", c:"#ecf0f1", cost:50000, speed:0.30, firerate:120, border:"gold"},
    {id:13, n:"GOD TIER", c:"rainbow", cost:0, speed:0.35, firerate:80, border:"#00f2ff"}
];

let audioCtx;
function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function playShootSound(vip) {
    if(!audioCtx) return;
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = vip ? 'sawtooth' : 'square';
    o.frequency.setValueAtTime(vip?600:400, audioCtx.currentTime);
    o.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.1);
    g.gain.setValueAtTime(0.04, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + 0.1);
}

function nav(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    if(id !== 'none') document.getElementById(id).classList.add('active');
    if(id === 'scr-menu') { renderShop(); if(user.isAdmin) updateAdminList(); }
    game.running = false;
    document.getElementById('hud').style.display = (id === 'none') ? 'block' : 'none';
}

function doLogin() {
    let u = document.getElementById('l-u').value, p = document.getElementById('l-p').value;
    if(u === 'admin' && p === '123') {
        user = {u:'ADMIN', coins:999999, owned:SKINS.map(s=>s.id), cur:12, used:[], isAdmin:true};
        document.getElementById('admin-panel').style.display = 'block'; nav('scr-menu');
    } else if(db[u] && db[u].p === p) {
        user = db[u]; document.getElementById('admin-panel').style.display = 'none'; nav('scr-menu');
    } else alert("Username/Password Salah!");
}

function doRegister() {
    let u = document.getElementById('r-u').value, p = document.getElementById('r-p').value;
    if(!u || !p || db[u]) return alert("Username tidak tersedia!");
    db[u] = {u, p, coins:500, owned:[0], cur:0, used:[]}; saveDB(); nav('scr-login');
}

function saveDB() { localStorage.setItem('nd_v9_db', JSON.stringify(db)); }

/* --- ADMIN POWER FUNCTIONS --- */
function updateAdminList() {
    const list = document.getElementById('user-list'); list.innerHTML = '';
    Object.values(db).forEach(u => {
        const row = document.createElement('div');
        row.className = 'user-row';
        
        let skinOptions = SKINS.map(s => `<option value="${s.id}">${s.n}</option>`).join('');

        row.innerHTML = `
            <div><b>${u.u}</b> | ${u.coins} C</div>
            <div class="admin-controls">
                <input type="number" id="amt-${u.u}" placeholder="Coin">
                <button class="btn-sml" style="background:var(--gold);color:black" onclick="giveCoin('${u.u}')">Kirim</button>
                <select id="skn-${u.u}" style="width: 80px;">${skinOptions}</select>
                <button class="btn-sml" style="background:var(--neon);color:black" onclick="giveSkin('${u.u}')">Beri</button>
                <button class="btn-sml" style="background:#ff3333" onclick="delUser('${u.u}')">X</button>
            </div>
        `;
        list.appendChild(row);
    });
}

function giveCoin(target) {
    const amt = parseInt(document.getElementById(`amt-${target}`).value);
    if(isNaN(amt)) return alert("Masukkan jumlah angka!");
    db[target].coins += amt;
    saveDB(); updateAdminList();
    alert(`Berhasil mengirim ${amt} koin ke ${target}`);
}

function giveSkin(target) {
    const skinId = parseInt(document.getElementById(`skn-${target}`).value);
    if(!db[target].owned.includes(skinId)) {
        db[target].owned.push(skinId);
        saveDB(); alert(`Skin diberikan ke ${target}`);
    } else {
        alert("User sudah punya skin ini");
    }
}

function delUser(target) {
    if(confirm(`Hapus akun ${target}?`)) { delete db[target]; saveDB(); updateAdminList(); }
}

/* --- GAMEPLAY --- */
function renderShop() {
    document.getElementById('u-n').innerText = user.u;
    document.getElementById('u-c').innerText = user.coins + " C";
    const g = document.getElementById('skin-grid'); g.innerHTML = '';
    SKINS.forEach(s => {
        let own = user.owned.includes(s.id);
        if(!own && s.cost === 0) return;
        let d = document.createElement('div'); d.className = `item ${user.cur === s.id ? 'active' : ''}`;
        let bg = s.c === 'rainbow' ? 'linear-gradient(red, blue)' : s.c;
        d.innerHTML = `<div class="pre" style="background:${bg}; border:${s.border?'1px solid '+s.border:'none'}"></div><div style="font-size:8px">${s.n}</div><div style="color:var(--gold)">${own?'PAKAI':s.cost}</div>`;
        d.onclick = () => { 
            if(own) user.cur=s.id; 
            else if(user.coins>=s.cost){ user.coins-=s.cost; user.owned.push(s.id); user.cur=s.id; }
            if(!user.isAdmin){ db[user.u]=user; saveDB(); }
            renderShop();
        };
        g.appendChild(d);
    });
}

let game = { running:false, px:0, py:0, tx:0, tilt:0, enemies:[], bullets:[], lastF:0, skor:0 };

function start() {
    nav('none');
    game = { ...game, running:true, px:cvs.width/2, py:cvs.height*0.8, tx:cvs.width/2, enemies:[], bullets:[], skor:0 };
}

function loop() {
    ctx.fillStyle = "rgba(2, 2, 5, 0.25)"; ctx.fillRect(0,0,cvs.width,cvs.height);
    if(game.running) {
        let s = SKINS.find(x => x.id === user.cur) || SKINS[0];
        game.px += (game.tx - game.px) * s.speed; game.tilt = (game.tx - game.px) * 0.1;
        if(Date.now() - game.lastF > s.firerate) { game.bullets.push({x:game.px, y:game.py-20, vip:s.id>=11}); playShootSound(s.id>=11); game.lastF = Date.now(); }
        game.bullets.forEach((b,i) => {
            b.y -= 15; ctx.fillStyle = b.vip ? "#00f2ff" : "#fff";
            ctx.fillRect(b.x-(b.vip?2:1), b.y, b.vip?4:2, 12);
            if(b.y < 0) game.bullets.splice(i,1);
        });
        if(Math.random() < 0.07) game.enemies.push({x:Math.random()*cvs.width, y:-20});
        game.enemies.forEach((e,i) => {
            e.y += (5 + game.skor/5000); ctx.fillStyle="#ff3333"; ctx.beginPath(); ctx.arc(e.x, e.y, 15, 0, Math.PI*2); ctx.fill();
            if(Math.hypot(game.px-e.x, game.py-e.y) < 25) {
                game.running = false; document.getElementById('final-skor').innerText = game.skor;
                if(!user.isAdmin){ user.coins+=Math.floor(game.skor/10); db[user.u]=user; saveDB(); }
                nav('scr-over');
            }
            game.bullets.forEach((b,bi) => { if(Math.hypot(b.x-e.x, b.y-e.y) < 22) { game.enemies.splice(i,1); game.bullets.splice(bi,1); game.skor+=100; } });
        });
        ctx.save(); ctx.translate(game.px, game.py); ctx.rotate(game.tilt);
        ctx.fillStyle = "orange"; ctx.fillRect(-4, 10, 8, s.id>=11?22:12);
        if(s.c==='rainbow'){ let g=ctx.createLinearGradient(-15,0,15,0); g.addColorStop(0,"red"); g.addColorStop(1,"blue"); ctx.fillStyle=g; }
        else ctx.fillStyle=s.c;
        ctx.beginPath(); ctx.moveTo(0,-25); ctx.lineTo(-20,10); ctx.lineTo(0,3); ctx.lineTo(20,10); ctx.closePath(); ctx.fill();
        if(s.border){ ctx.strokeStyle=s.border; ctx.lineWidth=3; ctx.stroke(); }
        ctx.restore();
        document.getElementById('skor-val').innerText = game.skor;
    }
    requestAnimationFrame(loop);
}

window.addEventListener('mousemove', e => game.tx = e.clientX);
window.addEventListener('touchmove', e => { game.tx = e.touches[0].clientX; e.preventDefault(); }, {passive:false});
cvs.width = window.innerWidth; cvs.height = window.innerHeight; loop();
</script>
</body>
</html>
